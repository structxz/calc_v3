# –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π[^1]

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π. –û–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:

- **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞** ‚Äì —É–ø—Ä–∞–≤–ª—è–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏ –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ –º–µ–∂–¥—É –∞–≥–µ–Ω—Ç–∞–º–∏.
- **–ê–≥–µ–Ω—Ç–æ–≤** ‚Äì –≤—ã–ø–æ–ª–Ω—è—é—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –∑–∞–ø—Ä–æ—Å—É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
- **API** - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ HTTP (REST) –∏ gRPC –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—ã—á–∏—Å–ª–µ–Ω–∏—è–º–∏ –∏ –∑–∞–¥–∞—á–∞–º–∏

## –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–∞–∑–æ–≤—ã—Ö –∞—Ä–∏—Ñ–º–µ—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (`+`, `-`, `*`, `/`).
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–±–µ–ª–æ–≤.
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏.
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
project-root/
‚îÇ
‚îÇ‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ orchestrator/      # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ agent/             # –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å –∞–≥–µ–Ω—Ç–∞
‚îÇ
‚îÇ‚îÄ‚îÄ configs/               # –§–∞–π–ª—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏
‚îÇ
‚îÇ‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ app/               # –õ–æ–≥–∏–∫–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
|   ‚îú‚îÄ‚îÄ auth/              # –õ–æ–≥–∏–∫–∞ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø–∞—Ä–æ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ constants/         # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
|   ‚îú‚îÄ‚îÄ db/
|       ‚îú‚îÄ‚îÄ sqlite         # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö SQLite
|   ‚îú‚îÄ‚îÄ jwtutil            # –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã JWT —Ç–æ–∫–µ–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ logger/            # –õ–æ–≥–≥–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
|   ‚îú‚îÄ‚îÄ middleware/        # Middleware —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
|   ‚îú‚îÄ‚îÄ orchestrator       # –õ–æ–≥–∏–∫–∞ gRPC —Å–µ—Ä–≤–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ worker/            # –õ–æ–≥–∏–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
‚îÇ
‚îÇ‚îÄ‚îÄ logs/              
‚îÇ   ‚îÇ‚îÄ‚îÄ agent/             # –õ–æ–≥–∏ –∞–≥–µ–Ω—Ç–∞
‚îÇ   ‚îÇ‚îÄ‚îÄ orchestrator/      # –õ–æ–≥–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚îÇ
‚îÇ‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã –ø—Ä–æ–µ–∫—Ç–∞
‚îÇ
‚îÇ‚îÄ‚îÄ pkg/                   # –õ–æ–≥–∏–∫–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
‚îÇ
‚îÇ‚îÄ‚îÄ .env                   # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ
‚îÇ‚îÄ‚îÄ docker-compose.yml     # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ Docker Compose
‚îú‚îÄ‚îÄ Dockerfile1            # –ó–∞–ø—É—Å–∫ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —á–µ—Ä–µ–∑ Docker
‚îú‚îÄ‚îÄ Dockerfile2            # –ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ Docker
‚îú‚îÄ‚îÄ Makefile               # –ó–∞–ø—É—Å–∫ Protoc –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ .pb.go —Ñ–∞–π–ª–æ–≤
‚îÇ‚îÄ‚îÄ README.md              # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
```

## –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

1. **–°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
   ```sh
   git clone https://github.com/structxz/calc_v3
   cd calc_v3
   ```
2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
   ```sh
   go mod tidy
   ```
3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤ –Ω–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
   - –ü—Ä–∏–º–µ—Ä `.env` —Ñ–∞–π–ª–∞ –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ `.env.example`
   - –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π `JWT_SECRET` –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

   ```sh
   openssl rand -base64 32
   ```
4. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É:**
   ```sh
   go run ./cmd/orchestrator/main.go
   go run ./cmd/agent/main.go
   ```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker

#### –ó–∞–ø—É—Å–∫

1. **–°–æ–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∏—Ö (—Ç–∞–∫–∂–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª –∫–∞–∫ –∏ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ):**

```sh
    docker compose up --build
```

2. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞**

```sh
   docker compose stop
```

3. **–£–¥–∞–ª–µ–Ω–∏–µ**

```sh
docker compose down
```

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å API

> –î–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–Ω–∞—á–∞–ª–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è.

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è**

- `POST http://localhost:8080/api/v1/register`

  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

  ```json
  {
      "login": "testlogin",
      "password": "testpassword"
  }
  ```

2. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**

- `POST http://localhost:8080/api/v1/login`

  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

  ```json
  {
      "login": "testlogin",
      "password": "testpassword"
  }
  ```

  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

  ```json
  {
      "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3NDY5NzQ4MDIsImlhdCI6MTc0Njk3NDY4Miwic3ViIjoiYWxleCJ9.o5ZWMgR2exVA1pOOE7jny0lhyUu2ti3X5t3h3TOp5GQ"
  }
  ```

3. **–û—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ**

- `POST http://localhost:8080/api/v1/calculate`

  - –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞

  ```json
  {
      "expression": "2+3"
  }
  ```

  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

  ```json
  {
      "id": "73ecc534-eb7b-4b12-83ec-4f441fbc98dc"
  }
  ```

4. **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã—Ä–∞–∂–µ–Ω–∏–∏ –ø–æ id**

- `GET http://localhost:8080/api/v1/expressions/73ecc534-eb7b-4b12-83ec-4f441fbc98dc`

  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

  ```json
  {
      "expression": {
            "id": "73ecc534-eb7b-4b12-83ec-4f441fbc98dc",
            "expression": "2+3",
            "status": "COMPLETE",
            "result": 5
      }
  }
  ```

5. **–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π**

- `GET http://localhost:8080/api/v1/expressions`

  - –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –µ—â–µ –æ–¥–Ω–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ)

  ```json
  {
      "expressions": [
        {
            "id": "415d1c9b-ef9d-45d6-b346-19505b9fc251",
            "expression": "3*3",
            "status": "COMPLETE",
            "result": 9
        },
        {
            "id": "73ecc534-eb7b-4b12-83ec-4f441fbc98dc",
            "expression": "2+3",
            "status": "COMPLETE",
            "result": 5,
        }
    ]
  }
  ```

### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —á–µ—Ä–µ–∑ `curl`

**üîê –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```bash
curl -X POST http://localhost:8080/api/v1/register \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "testpass"}'
```

**üîë –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞)**

```bash
curl -X POST http://localhost:8080/api/v1/login \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser", "password": "testpass"}'
```

üí° –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –í –æ—Ç–≤–µ—Ç–µ –±—É–¥–µ—Ç JSON —Å —Ç–æ–∫–µ–Ω–æ–º:

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsIn..."
}
```

**‚ûï 3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ**

```bash
curl -X POST http://localhost:8080/api/v1/calculate \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <TOKEN>" \
  -d '{"expression": "3 + 4"}'
```

`<TOKEN>` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ JWT –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞.

**üìã 4. –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```bash
curl -X GET http://localhost:8080/api/v1/expressions \
  -H "Authorization: Bearer <TOKEN>"
```

**üîé 5. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è**

```bash
curl -X GET http://localhost:8080/api/v1/expressions/1 \
  -H "Authorization: Bearer <TOKEN>"
```

`1` –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –Ω—É–∂–Ω—ã–π ID –≤—ã—Ä–∞–∂–µ–Ω–∏—è

---

## –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã

```text
+--------------------+                      +-------------------+                       
|    Client (User)   |                      |    Orchestrator   |
|    (REST / gRPC)   |                      +-------------------+
+---------+-----^----+                                |
     |          |                                     | (gRPC) 
     |  (REST)  |                                     | 
     |          |                           +---------v---------+  
+----v---------------+                      |      Agent 1      | 
|      REST API      |                      +-------------------+
|      (server)      |                                |
+---------------^----+                                |
     |          |                                     | (gRPC) 
     |  (REST)  |                                     |
     |          |                                     |      
+----v---------------+                      +---------v---------+ 
|  Database (SQLite) |                      |    Orchestrator   |
+--------------------+                      +-------------------+
```

1. Client (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —á–µ—Ä–µ–∑ REST API –∏–ª–∏ gRPC.
2. Orchestrator —É–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∞–º–∏ –∏ –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –∞–≥–µ–Ω—Ç–∞–º –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
3. –ê–≥–µ–Ω—Ç—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
4. –í—Å–µ –∑–∞–¥–∞—á–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:**
   ```sh
   go test ./test 
   ```

## –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—ã—á–∏—Å–ª–µ–Ω–∏–π —Å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

[^1]: –ü—Ä–æ–µ–∫—Ç –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –Ø–Ω–¥–µ–∫—Å –õ–∏—Ü–µ—è –∏ –µ–≥–æ –ª–∏—Ü–µ–∏—Å—Ç–æ–≤
